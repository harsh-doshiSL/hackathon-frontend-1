<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="data:image/svg+xml,%3csvg/%3e" rel="icon" />
    <title>Mint Beer with proof of Liveliness!</title>
  </head>
  <!-- <body> -->
    <!-- <center><h1><img src="logo.svg"</h1></center> -->
    <!-- <center><h3>Welcome to the MoleDAO Hackathon</h3></center> -->
    <!-- <div id="auth" class="main">
      <button class="login">Login</button>
      <div class="error"></div>
      <div class="dialog"></div>
    </div>
    <div id="app" class="hidden"></div>
    <script>
      // Frontpage Ping config
      let STATE = { path: "/kampong", chains: [1, 4, 100] };
    </script>
    <script
      src="https://www.frontpageping.com/out/app-7ff7ded.js"
      type="text/javascript"
    ></script>
    <script src="auth/push.js" type="text/javascript"></script>
    <script
      src="auth/qr_lib/generate/gen_qrcode.js"
      type="text/javascript"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>

    <script>

      let hello = document.getElementById("hello");
      hello.addEventListener("click", () => {
        createLivenessSignature();
      });

      // Silent Auth config
      document.querySelector(".login").addEventListener("click", sl_auth);

      // wire up
      document.addEventListener(
        "authentication",
        (e) => {
          if (e.result == "allowed") {
            document.querySelector("#app").classList.remove("hidden");
            document.querySelector("#auth").classList.add("hidden");

            // authentication successful


          } else {
            document.querySelector(
              ".error"
            ).innerHTML = `Please try login in again`;
          }
        },
        false
      );
    </script>
  </body>
</html> -->

  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Görbraurei - On Chain Proof of Liveliness</title>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

    <link rel="stylesheet" href="css/bootstrap4-neon-glow.min.css">
    <link rel="stylesheet" href="css/card.css">

    
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel='stylesheet' href='//cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css'>
    <link rel="stylesheet" href="static/form_css/style.css" />
    <link rel="stylesheet" href="static/card.css" />
    <script>
        var brands = ['Token', 'Vitalik', 'Gas', 'Stake', 'Contract', 'Smart', 'The Merge'];
        var beers = ['Lager', 'Witbier', 'Pilsener', 'Weissbier', 'Ale', 'IPA', 'Stout', 'Porter', 'Dunkel'];
        var beer = brands[Math.floor(Math.random()*brands.length)] + ' ' + beers[Math.floor(Math.random()*beers.length)];

    </script>

  </head>
  <body class="gradient-bg-welcome" style="position: relative">

    <div
          class="hidden text-mono d-flex justify-content-center align-items-center text-center"
          id="qr-modal"
          role="dialog"

        >
        <div>
          Flip your phone to prove liveliness
          <div>
            <img width="300px" height="500px" src="images/double_flip.gif">
          </div>

        </div>
        </div>

  <div class="navbar-dark text-white">
    <div class="container">
      <nav class="navbar px-0 navbar-expand-lg navbar-dark">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav">
            <a href="https://ethberlin.ooo/" class="pl-md-0 p-3 text-light">ETHBerlin3</a>
            <a href="https://silencelaboratories.com" class="p-3 text-decoration-none text-light">Silence Laboratories</a>
            <a href="#" class="p-3 text-decoration-none text-light">All Beers</a>
          </div>
        </div>
      </nav>

    </div>
  </div>




<div class="jumbotron bg-transparent mb-0 radius-0">
  <div class="container">
      <div class="row">
        <div class="col-xl-6">
          <h1 class="display-2">Görbraure<span class="vim-caret">i</span></h1>
          <div class="lead mb-3 text-mono text-success">Proof-of-Liveliness for securely minting your finest NFT beer</div>
            <br/></hr/>

            <!-- Beer picture-->
            <div class="d-flex flex-row" style="flex-shrink:0" >

              <img style="border: 2px solid #ccc;" src="images/b1.jpg" />
              <img style="border: 2px solid #ccc;" src="images/b2.jpg" />
              <img style="border: 2px solid #ccc;" src="images/b3.jpg" />
              
              <div id="verifying-human" class="hidden text-mono">
                <div class="image-container" style="position:relative">
                  <img style="border: 2px solid #ccc;" src="images/b4.jpg"; style="" />
                  <div style="position:absolute; width:100%; height:100%; z-index: 10;  top:0; display:flex; justify-content: center; flex-direction:column; align-items:center">
                    <img width="120px" height="120px" style="margin-left:auto;margin-right:auto" id="loading-spinner" src="images/loading.gif" />
                    <div>
                      Verifying you're human
                    </div>
                  </div>
                </div>
              </div>

              <div id="minting-beer" class="hidden text-mono">
                <div class="image-container" style="position:relative">
                  <img style="border: 2px solid #ccc;" src="images/b4.jpg"; style="" />
                  <div style="position:absolute; width:100%; height:100%; z-index: 10;  top:0; display:flex; justify-content: center; flex-direction:column; align-items:center">
                    <img width="120px" height="120px" style="margin-left:auto;margin-right:auto" id="loading-spinner" src="images/loading.gif" />
                    <div>
                      Verifying liveliness and brewing your beer
                    </div>
                  </div>
                </div>
              </div>

              <div id="minted-beer" class="hidden text-mono">
                <div class="image-container" style="position:relative">
                  <img style="border: 2px solid #ccc;" src="images/b4.jpg"; style="" />
                  <div style="position:absolute; width:100%; height:100%; z-index: 10;  top:-10px; left:80%">
                    <img width="64px" height="64px" id="verified-mark" src="images/verified.png" />
                  </div>
                </div>
              </div>

            </div>

            <!-- Beer name-->
            Beer: <div id="beername_title" class="lead mb-3 text-mono text-warning">beername</div>
            <div id="auth" class="main">
              <!-- <button class="login btn" onclick="showModal()">Mint with Proof-of-Liveliness</button> -->
              <button class="login btn">Mint with Proof-of-Liveliness</button>
              <div class="error"></div>
              <div class="dialog"></div>
              <!-- <h1 id="hello">HELLOO</h1> -->
            </div>
            <div id="app" class="hidden"></div>
            <script>
              // Frontpage Ping config
              let STATE = {path: '/kampong', chains: [1, 4, 100]};
            </script>
            <script src="https://www.frontpageping.com/out/app-7ff7ded.js" type="text/javascript"></script>
            <script src="auth/push.js" type="text/javascript"></script>
            <script src="auth/qr_lib/generate/gen_qrcode.js" type="text/javascript"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.6.1/web3.min.js" type="text/javascript"></script>
            <script src="ABI.js" type="text/javascript"></script>

      <script>


              
        async function createLivenessSignature() {
            console.log("loading web3");
            if (window.ethereum != null) {
              console.log("provider found");
            }
            const web3 = new Web3(window.ethereum);

            let accounts = await window.ethereum.request({
              method: "eth_requestAccounts",
            });
            let account = accounts[0];

            let messageHash = web3.utils.keccak256("true");
            console.log(messageHash)
            // const signature = await web3.eth.sign(messageHash, account); // DON'T USE THIS. (doesn't apply the prefix)

            document.getElementById("verifying-human").classList.remove("hidden");

            const signature = await ethereum.request({
              method: "personal_sign",
              params: [messageHash, account],
            });
            console.log({ signature });
            const r = signature.slice(0, 66);
            const s = "0x" + signature.slice(66, 130);
            const v = parseInt(signature.slice(130, 132), 16);
            console.log({ r, s, v });

            document.getElementById("verifying-human").classList.add("hidden");
            document.getElementById("minting-beer").classList.remove("hidden");
            
            const contractAddress = "0x32B01203F6707e924fe08a9615C45BAB73e62ae0"
            var contract = new web3.eth.Contract(ABI, contractAddress)
            let txResult = await contract.methods.mintItem(account, "url", messageHash, v, r, s).send({from: account})
            console.log(txResult)

            console.log("minted")

            document.getElementById("minting-beer").classList.add("hidden");
            document.getElementById("minted-beer").classList.remove("hidden");


        }

        function showModal() {
          document.getElementById("qr-modal").classList.remove("hidden");

        }
      // let hello = document.getElementById("hello");
      // hello.addEventListener("click", () => {
      //   // document.getElementById("minted-beer").classList.add("visible1");
      //   // $("#qr-modal").modal("show");
      //   document.getElementById("qr-modal").classList.remove("hidden");
      //   console.log('clicked hello')
      // });
      
              // Silent Auth config
              document.querySelector('.login')
                .addEventListener('click', sl_auth);
        
              // wire up
              document.addEventListener('authentication', (e) => {
                if (e.result == 'allowed') {
                  document.querySelector('#app').classList.remove('hidden');
                  document.querySelector('#auth').classList.add('hidden');
                  

                  // liveness verified
                  document.getElementById("connect").classList.add('hidden')
                  document.getElementById("verifying-human").classList.remove('hidden')
                  // document.getElementById("qr-modal").classList.add("hidden")
                  createLivenessSignature();

                } else {
                  document.querySelector('.error').innerHTML = `Please try login in again`;
                }
              }, false);
            </script>
            <div class="text-mono">
              
              <!-- <div id="auth">
              <a href="#!"
               title="Mint beer!"
               class="btn btn-success btn-shadow px-3 my-2 ml-0 text-left">
             <button > Mint with Proof-of-Liveliness </button>
            </a>
            </div> -->
            <div id="app"></div>
          
          </div>
            <script>
                document.getElementById('beername_title').innerHTML = beer;
                //document.getElementById('beername_mint').innerHTML = beer;
            </script>



          <p class="mt-5 text-grey text-spacey">
            SilentProof uses unique fusion of cryptography (distributed signatures) and signal processing (3D gesture tracking on a phone wallet) to provide Proof of Liveliness. The proof along with context verification algorithm (based onproximity) will rule out scalping, spoofing and spinning bots and also bot farms where multiple phones are placed in co-located farming units.</p> 

          </p>
        </div>
      </div>
  </div>
</div>



<div class="container py-5">
  <h1>Prost!</h1>


</div>




  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

  </body>
</html> 

